<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>北護課程查詢系統 - 學生</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/student.css') }}">
</head>
<body>
    <!-- ========================================
         左側導航選單
         ======================================== -->
    <nav class="sidebar">
        <!-- 系統標題 -->
        <div class="sidebar-header">
            <h3>NTUNHS</h3>
            <p>課程查詢系統</p>
        </div>
        
        <!-- 導航選單 -->
        <ul class="nav-menu">
            <li class="nav-item active">
                <a href="#" onclick="showSection('home'); return false;">
                    <svg width="24" height="24" fill="currentColor">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                        <polyline points="9 22 9 12 15 12 15 22"/>
                    </svg>
                    <span>首頁</span>
                </a>
            </li>
            
            <li class="nav-item">
                <a href="#" onclick="showSection('favorites'); return false;">
                    <svg width="24" height="24" fill="currentColor">
                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                    </svg>
                    <span>收藏清單</span>
                </a>
            </li>
            
            <li class="nav-item">
                <a href="#" onclick="showSection('preselect'); return false;">
                    <svg width="24" height="24" fill="currentColor">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                        <line x1="16" y1="2" x2="16" y2="6"/>
                        <line x1="8" y1="2" x2="8" y2="6"/>
                        <line x1="3" y1="10" x2="21" y2="10"/>
                    </svg>
                    <span>預選課表</span>
                </a>
            </li>
        </ul>
        
        <!-- 底部：登出+吉祥物 -->
        <div class="sidebar-footer">
            <button class="logout-btn" onclick="logout()">
                <svg width="20" height="20" fill="currentColor">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                    <polyline points="16 17 21 12 16 7"/>
                    <line x1="21" y1="12" x2="9" y2="12"/>
                </svg>
                <span>登出</span>
            </button>
            
            <div class="mascot" onclick="showProfileModal()" style="cursor: pointer;" title="個人檔案">
                <div class="mascot-icon" id="studentAvatar">🐱</div>
                <p id="studentName">學生</p>
            </div>
        </div>
    </nav>
    
    <!-- ========================================
         主要內容區
         ======================================== -->
    <main class="main-content">
        <!-- ========================================
             頂部Header
             ======================================== -->
        <header class="top-header">
            <div class="header-left">
                <svg class="school-logo" viewBox="0 0 100 100">
                    <circle cx="50" cy="50" r="45" fill="#2D5A3D" stroke="#FFD700" stroke-width="3"/>
                    <rect x="42" y="20" width="16" height="60" fill="white" rx="2"/>
                    <rect x="20" y="42" width="60" height="16" fill="white" rx="2"/>
                </svg>
                <div>
                    <h2>國立臺北護理健康大學</h2>
                    <p>National Taipei University of Nursing and Health Sciences</p>
                </div>
            </div>
            
            <div class="header-right">
                <a href="https://www.ntunhs.edu.tw" target="_blank" class="header-link">
                    <svg width="20" height="20" fill="currentColor">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                    </svg>
                    學校首頁
                </a>
                <a href="https://system8.ntunhs.edu.tw/myNTUNHS_student/Modules/Main/Index_student.aspx?first=true" target="_blank" class="header-link">
                    <svg width="20" height="20" fill="currentColor">
                        <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                        <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                    </svg>
                    e-portfolio 學習歷程
                </a>
            </div>
        </header>
        
        <!-- ========================================
             Section 1: 首頁 - 課程搜尋
             ======================================== -->
        <section id="homeSection" class="content-section active">
            <!-- 搜尋區 -->
            <div class="search-container">
                <!-- 第一行：學期 + 關鍵字 -->
                <div class="search-row">
                    <label>*學期：</label>
                    <select id="semesterSelect" class="form-select">
                        <option value="">請選擇學期</option>
                        <option value="1142">1142</option>
                        <option value="1141">1141</option>
                        <option value="1132">1132</option>
                        <option value="1131">1131</option>
                    </select>
                    
                    <input 
                        type="text" 
                        id="keywordInput" 
                        class="search-input" 
                        placeholder="🔍 關鍵字查詢 (請輸入授課教師、課程名稱或教室)"
                    >
                </div>
                
                <!-- 篩選條件按鈕 -->
                <div class="filter-buttons">
                    <button class="filter-btn" onclick="toggleFilterPanel('dept'); return false;">系所/年級/課別 ⌄</button>
                    <button class="filter-btn" onclick="toggleFilterPanel('weekday'); return false;">星期 ⌄</button>
                    <button class="filter-btn" onclick="toggleFilterPanel('degree'); return false;">學制 ⌄</button>
                    <button class="filter-btn" onclick="toggleFilterPanel('period'); return false;">節次 ⌄</button>
                    <button class="filter-btn" onclick="toggleFilterPanel('category'); return false;">課程內容分類 ⌄</button>
                </div>
                
                <!-- 篩選面板容器 -->
                <div id="filterPanelContainer"></div>
                
                <!-- 第二行：系所/年級/課別 -->
                <div class="filter-row">
                    <label>星期：</label>
                    <div class="weekday-checkboxes">
                        <label><input type="checkbox" name="weekday" value="1"> 週一</label>
                        <label><input type="checkbox" name="weekday" value="2"> 週二</label>
                        <label><input type="checkbox" name="weekday" value="3"> 週三</label>
                        <label><input type="checkbox" name="weekday" value="4"> 週四</label>
                        <label><input type="checkbox" name="weekday" value="5"> 週五</label>
                        <label><input type="checkbox" name="weekday" value="6"> 週六</label>
                        <label><input type="checkbox" name="weekday" value="7"> 週日</label>
                    </div>
                </div>
                
                <div class="filter-row">
                    <label>系所：</label>
                    <select id="departmentSelect" class="form-select">
                        <option value="">請選擇系所</option>
                    </select>
                    
                    <label>年級：</label>
                    <select id="gradeSelect" class="form-select">
                        <option value="">請選擇年級</option>
                        <option value="1">一年級</option>
                        <option value="2">二年級</option>
                        <option value="3">三年級</option>
                        <option value="4">四年級</option>
                    </select>
                    
                    <label>課別：</label>
                    <select id="typeSelect" class="form-select">
                        <option value="">請選擇課別</option>
                        <option value="專業必修(系所)">專業必修(系所)</option>
                        <option value="專業選修(系所)">專業選修(系所)</option>
                        <option value="通識必修(通識)">通識必修(通識)</option>
                        <option value="通識選修(通識)">通識選修(通識)</option>
                    </select>
                </div>
                
                <!-- 搜尋按鈕 -->
                <div class="search-actions">
                    <button class="btn-search" onclick="searchCourses()">
                        🔍 查詢
                    </button>
                    <button class="btn-clear" onclick="clearFilters()">
                        ✕ 清除
                    </button>
                </div>
            </div>
            
            <!-- 結果區 -->
            <div class="result-container">
                <div id="searchResult" class="search-result">
                    <p class="no-result">請輸入搜尋條件並查詢課程</p>
                </div>
            </div>
        </section>
        
        <!-- ========================================
             Section 2: 收藏清單
             ======================================== -->
        <section id="favoritesSection" class="content-section">
            <h2 class="section-title">❤️ 我的收藏</h2>
            <div id="favoritesList" class="courses-grid">
                <p class="no-result">尚無收藏課程</p>
            </div>
        </section>
        
        <!-- ========================================
             Section 3: 預選課表
             ======================================== -->
        <section id="preselectSection" class="content-section">
            <h2 class="section-title">📅 預選課表</h2>
            <div class="schedule-container">
                <table class="schedule-table">
                    <thead>
                        <tr>
                            <th class="schedule-header time-col">節次</th>
                            <th class="schedule-header">星期一</th>
                            <th class="schedule-header">星期二</th>
                            <th class="schedule-header">星期三</th>
                            <th class="schedule-header">星期四</th>
                            <th class="schedule-header">星期五</th>
                            <th class="schedule-header">星期六</th>
                            <th class="schedule-header">星期日</th>
                        </tr>
                    </thead>
                    <tbody id="scheduleBody">
                        <!-- 動態生成 -->
                    </tbody>
                </table>
            </div>
            
            <div class="schedule-footer">
                <span class="credits-total">學分總計：<span id="totalCredits">0</span></span>
            </div>
        </section>
    </main>
    
    <!-- ========================================
         Modal: 個人檔案主選單
         ======================================== -->
    <div id="profileModal" class="modal">
        <div class="modal-content modal-profile">
            <div class="modal-header">
                <h3>個人檔案</h3>
                <button class="close-btn" onclick="closeProfileModal()">✖</button>
            </div>
            <div class="modal-body profile-menu">
                <div class="profile-card">
                    <div class="profile-avatar" id="profileModalAvatar">🐱</div>
                    <div class="profile-name" id="profileDisplayName">學生</div>
                    <div class="profile-id" id="profileDisplayId">學號：-</div>
                </div>
                
                <div class="profile-actions">
                    <button class="profile-btn" onclick="showEditProfileModal()">
                        <span class="btn-icon">📝</span>
                        <span>修改檔案</span>
                    </button>
                    <button class="profile-btn" onclick="showChangePasswordModal()">
                        <span class="btn-icon">🔒</span>
                        <span>帳號管理</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ========================================
         Modal: 修改檔案 (Figma設計)
         ======================================== -->
    <div id="editProfileModal" class="modal">
        <div class="modal-content modal-figma-profile">
            <div class="modal-header-figma">
                <div class="modal-title-with-icon">
                    <span class="modal-icon">📝</span>
                    <h3>個人檔案</h3>
                </div>
                <button class="close-btn" onclick="closeEditProfileModal()">✖</button>
            </div>
            <div class="modal-body-figma">
                <div class="modal-card-profile">
                    <!-- 大頭貼區域 -->
                    <div class="avatar-display-area">
                        <div class="avatar-large-circle" id="editProfileAvatarDisplay">🐱</div>
                    </div>
                    
                    <!-- 小頭貼選擇器 -->
                    <div class="avatar-selector-row">
                        <span class="avatar-option-sm" data-avatar="🐱" onclick="selectStudentAvatar(this)">🐱</span>
                        <span class="avatar-option-sm" data-avatar="🐶" onclick="selectStudentAvatar(this)">🐶</span>
                        <span class="avatar-option-sm" data-avatar="🐰" onclick="selectStudentAvatar(this)">🐰</span>
                        <span class="avatar-option-sm" data-avatar="🐼" onclick="selectStudentAvatar(this)">🐼</span>
                        <span class="avatar-option-sm" data-avatar="🦊" onclick="selectStudentAvatar(this)">🦊</span>
                        <span class="avatar-option-sm" data-avatar="🐨" onclick="selectStudentAvatar(this)">🐨</span>
                        <span class="avatar-option-sm" data-avatar="🦁" onclick="selectStudentAvatar(this)">🦁</span>
                        <span class="avatar-option-sm" data-avatar="🐯" onclick="selectStudentAvatar(this)">🐯</span>
                        <span class="avatar-option-sm" data-avatar="🐸" onclick="selectStudentAvatar(this)">🐸</span>
                        <span class="avatar-option-sm" data-avatar="🐵" onclick="selectStudentAvatar(this)">🐵</span>
                        <span class="avatar-option-sm" data-avatar="🦄" onclick="selectStudentAvatar(this)">🦄</span>
                        <span class="avatar-option-sm" data-avatar="🐲" onclick="selectStudentAvatar(this)">🐲</span>
                    </div>
                    <input type="hidden" id="editProfileAvatar" value="🐱">
                    
                    <!-- 表單欄位 - 兩欄式 -->
                    <form id="editProfileForm" onsubmit="submitEditProfile(event)">
                        <div class="form-grid-2col">
                            <div class="form-group-figma">
                                <label>姓名:</label>
                                <input type="text" id="editProfileName" readonly class="readonly-input">
                            </div>
                            
                            <div class="form-group-figma">
                                <label>學號:</label>
                                <input type="text" id="editProfileStudentId" readonly class="readonly-input">
                            </div>
                            
                            <div class="form-group-figma">
                                <label>系所:</label>
                                <input type="text" id="editProfileDepartment" readonly class="readonly-input">
                            </div>
                            
                            <div class="form-group-figma">
                                <label>班級:</label>
                                <input type="text" id="editProfileClass" readonly class="readonly-input">
                            </div>
                        </div>
                        
                        <div class="form-group-figma">
                            <label>電話:</label>
                            <input type="tel" id="editProfilePhone" placeholder="請輸入學號/ID">
                        </div>
                        
                        <div class="form-group-figma">
                            <label>電子郵件:</label>
                            <input type="email" id="editProfileEmail" placeholder="請輸入學號/ID">
                        </div>
                        
                        <div class="modal-footer-figma">
                            <button type="button" class="btn-cancel-figma" onclick="closeEditProfileModal()">取消</button>
                            <button type="submit" class="btn-save-figma">儲存</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ========================================
         Modal: 變更密碼 (Figma設計)
         ======================================== -->
    <div id="changePasswordModal" class="modal">
        <div class="modal-content modal-figma-password">
            <div class="modal-header-figma">
                <div class="modal-title-with-icon">
                    <span class="modal-icon">🔒</span>
                    <h3>更新密碼</h3>
                </div>
                <button class="btn-back-figma" onclick="closeChangePasswordModal()">返回</button>
            </div>
            <div class="modal-body-figma">
                <div class="modal-card">
                    <form id="changePasswordForm" onsubmit="submitChangePassword(event)">
                        <div class="form-group-figma">
                            <label>舊密碼：</label>
                            <input type="password" id="oldPassword" required placeholder="請輸入舊密碼">
                        </div>
                        
                        <div class="form-group-figma">
                            <label>新密碼：</label>
                            <input type="password" id="newPassword" required placeholder="請輸入新密碼">
                        </div>
                        
                        <div class="form-group-figma">
                            <label>再次輸入新密碼：</label>
                            <input type="password" id="confirmPassword" required placeholder="請再次輸入新密碼">
                        </div>
                        
                        <div id="passwordMessage" class="message"></div>
                        
                        <button type="submit" class="btn-confirm-figma">確定</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ========================================
         Modal: 課程詳情
         ======================================== -->
    <div id="courseDetailModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 id="courseDetailTitle">課程詳情</h3>
                <button class="close-btn" onclick="closeCourseDetailModal()">✖</button>
            </div>
            <div class="modal-body" id="courseDetailContent">
                <!-- 動態填入 -->
            </div>
        </div>
    </div>
    
    <!-- JavaScript -->
    <script src="{{ url_for('static', filename='js/student.js') }}"></script>
</body>
</html>
